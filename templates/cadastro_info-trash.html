<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Informações Pessoais</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cadastro_info.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="form-card">
            <h1>Preencha suas informações</h1>
            <form action="/cadastro_info" method="POST">
                <p>E-mail</p>
                <input 
                    type="email" 
                    name="email" 
                    placeholder="email@exemplo.com" 
                    value="{{ test_data.get('email', '') }}" 
                    oninput="validateEmail()" 
                    required>
                <div class="error-message email-error">
                    <span class="error-icon">⚠️</span>
                    Por favor, insira um e-mail válido.
                </div>
            
                <p>Nome Completo</p>
                <input 
                    type="text" 
                    name="nome" 
                    placeholder="Seu nome completo" 
                    value="{{ test_data.get('nome', '') }}" 
                    oninput="validateName()" 
                    required>
                <div class="error-message name-error">
                    <span class="error-icon">⚠️</span>
                    O nome deve ter pelo menos 3 caracteres.
                </div>
            
                <p>Data de Nascimento</p>
                <input 
                    type="date" 
                    name="data_nascimento" 
                    value="{{ test_data.get('data_nascimento', '') }}" 
                    onchange="validateDate()" 
                    required>
                <div class="error-message date-error">
                    <span class="error-icon">⚠️</span>
                    Você precisa ter pelo menos 18 anos.
                </div>
            
                <p>Senha</p>
                <div class="password-container">
                    <input 
                        type="password" 
                        id="senha" 
                        name="senha" 
                        placeholder="Mínimo 8 caracteres" 
                        value="{{ test_data.get('senha', '') }}" 
                        oninput="validatePassword()" 
                        required>
                    <i class="fas fa-eye toggle-password" onclick="togglePasswordVisibility('senha', this)"></i>
                </div>
                <div class="error-message password-error">
                    <span class="error-icon">⚠️</span>
                    A senha deve ter pelo menos 8 caracteres.
                </div>
            
                <p>Confirmar Senha</p>
                <div class="password-container">
                    <input 
                        type="password" 
                        id="confirmar_senha" 
                        name="confirmar_senha" 
                        placeholder="Repita a senha" 
                        value="{{ test_data.get('senha', '') }}" 
                        oninput="validateConfirmPassword()" 
                        required>
                    <i class="fas fa-eye toggle-password" onclick="togglePasswordVisibility('confirmar_senha', this)"></i>
                </div>
                <div class="error-message confirm-password-error">
                    <span class="error-icon">⚠️</span>
                    As senhas não coincidem.
                </div>
                <button type="submit">Continuar</button>
            </form>            
        </div>
    </div>

    <script>
        // Validações existentes
        function validateEmail() {
            const emailInput = document.querySelector('input[name="email"]');
            const errorMessage = document.querySelector('.email-error');
            const emailPattern = /^[^ ]+@[^ ]+\.[a-z]{2,3}$/;

            if (!emailInput.value.match(emailPattern)) {
                errorMessage.style.display = 'flex';
            } else {
                errorMessage.style.display = 'none';
            }
        }

        function validateName() {
            const nameInput = document.querySelector('input[name="nome"]');
            const errorMessage = document.querySelector('.name-error');

            if (nameInput.value.trim().length < 3) {
                errorMessage.style.display = 'flex';
            } else {
                errorMessage.style.display = 'none';
            }
        }

        function validateDate() {
            const dateInput = document.querySelector('input[name="data_nascimento"]');
            const errorMessage = document.querySelector('.date-error');
            const today = new Date();
            const birthDate = new Date(dateInput.value);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();

            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }

            if (age < 18) {
                errorMessage.style.display = 'flex';
            } else {
                errorMessage.style.display = 'none';
            }
        }

        function validatePassword() {
            const passwordInput = document.querySelector('input[name="senha"]');
            const errorMessage = document.querySelector('.password-error');

            if (passwordInput.value.length < 8) {
                errorMessage.style.display = 'flex';
            } else {
                errorMessage.style.display = 'none';
            }
        }

        function validateConfirmPassword() {
            const passwordInput = document.querySelector('input[name="senha"]');
            const confirmPasswordInput = document.querySelector('input[name="confirmar_senha"]');
            const errorMessage = document.querySelector('.confirm-password-error');

            if (confirmPasswordInput.value !== passwordInput.value) {
                errorMessage.style.display = 'flex';
            } else {
                errorMessage.style.display = 'none';
            }
        }

        // Atualiza a função de alternância de visibilidade da senha
        function togglePasswordVisibility(inputId, icon) {
            const input = document.getElementById(inputId);
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                input.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }
    </script>
</body>
</html>
