<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconhecimento Facial - DocFacer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cadastro_facial.css') }}">
</head>
<body>
    <div class="container">
        <div class="form-card">
            <h1>Reconhecimento Facial</h1>
            <p>Posicione seu rosto no centro da câmera e siga as instruções para concluir a prova de vida.</p>

            <!-- Área de vídeo para o feed da câmera -->
            <div id="video-container">
                <img id="video-feed" src="{{ url_for('video_feed') }}" alt="Feed da Câmera">
            </div>

            <!-- Feedback de progresso -->
            <div id="feedback" style="margin-top: 20px; font-size: 18px; color: #333;">
                <p id="status-msg">Iniciando reconhecimento facial...</p>
                <div id="loading" style="display: none;">
                    <img src="{{ url_for('static', filename='img/loading.gif') }}" alt="Processando..." style="width: 50px;">
                </div>
            </div>

            <!-- Barra de progresso -->
            <div id="progress-bar-container">
                <div id="progress-bar" style="width: 0%; background-color: green; height: 20px;"></div>
            </div>
        </div>
    </div>

    <!-- Script para integração com a câmera e feedbacks -->
    <script>
        // Função para atualizar a barra de progresso
        function updateProgressBar(progress) {
            const progressBar = document.getElementById('progress-bar');
            const statusMsg = document.getElementById('status-msg');
            const loading = document.getElementById('loading');

            // Atualiza largura da barra de progresso
            progressBar.style.width = progress + '%';

            // Define mensagens de feedback e exibição de loading
            if (progress === 100) {
                statusMsg.textContent = 'Autenticação Bem-Sucedida!';
                statusMsg.style.color = 'green';
                loading.style.display = 'none';
            } else if (progress === 50) {
                statusMsg.textContent = 'Face reconhecida. Realizando prova de vida...';
                statusMsg.style.color = 'orange';
                loading.style.display = 'block'; // Mostra o loading
            } else if (progress === 25) {
                statusMsg.textContent = 'Posicione seu rosto corretamente.';
                statusMsg.style.color = 'blue';
                loading.style.display = 'none';
            } else {
                statusMsg.textContent = 'Iniciando reconhecimento facial...';
                loading.style.display = 'block'; // Mostra o loading
            }
        }


        // Atualiza o progresso a cada 1 segundo
        setInterval(() => {
            fetch('/progress')
                .then(response => response.json())
                .then(data => {
                    updateProgressBar(data.progress);
                    const statusMsg = document.getElementById('status-msg');
                    statusMsg.textContent = data.status; // Exibe o status retornado do servidor
                })
                .catch(error => {
                    console.error('Erro ao obter progresso:', error);
                    const statusMsg = document.getElementById('status-msg');
                    statusMsg.textContent = 'Erro ao processar. Tente novamente.';
                    statusMsg.style.color = 'red';
                });
        }, 1000); // Atualiza a cada 1 segundo
    </script>
</body>
</html>
